[![](https://www.cliff.ai/full_logo_dark.svg)](https://www.cliff.ai/full_logo_dark.svg)

------------

#  JAVA Backend Assessment

##### REST API Creation with SpringBoot Hibernate and MySQL

### Description 
Created **CRUD** endpoints in Spring boot with with two models Teams and Players
possess **one to many ** relationship between them.
Basically, a team has many players (**one to many**).

### Features

- An API that manages the data for Team and Players
- Contains oneToMany Relationship, One team contains many Players.
- 3 tier Architecture approach.
- CRUD(Create Read Update Delete) operations on Team
- CRUD(Create Read Update Delete) operations on Players

## Architecture of API
Its a three tier Architeture divided between Model Service Repository and DAO Package.
[![Three tier Arch.](https://docs.aws.amazon.com/whitepapers/latest/serverless-multi-tier-architectures-api-gateway-lambda/images/image2.png "Three tier Arch.")](https://docs.aws.amazon.com/whitepapers/latest/serverless-multi-tier-architectures-api-gateway-lambda/images/image2.png "Three tier Arch.")

where,
- Postman is client,
- Service layer-Business logic
- Dao - Database

## Technologies
- Spring Boot
- Hibernate
- MySQL
- Swagger


## Dependecies
- SpringWeb
- SpringData JPA
- MySQL Driver
- Swagger
- Lombok 

```sql
<dependencies>
		<dependency>
				<groupId>io.swagger</groupId>
				<artifactId>swagger-annotations</artifactId>
				<version>1.5.0</version>
			</dependency>
			<dependency>
				<groupId>io.springfox</groupId>
				<artifactId>springfox-swagger2</artifactId>
				<version>2.9.2</version>
			</dependency>
			<dependency>
				<groupId>io.springfox</groupId>
				<artifactId>springfox-swagger-ui</artifactId>
				<version>2.9.2</version>
			</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-jpa</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>

		<dependency>
			<groupId>mysql</groupId>
			<artifactId>mysql-connector-java</artifactId>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>org.projectlombok</groupId>
			<artifactId>lombok</artifactId>
			<optional>true</optional>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
	</dependencies>
```

## Package
 Followiing is the layout of Package
 
![image](https://user-images.githubusercontent.com/71382700/155856506-40e79901-4a80-4cb1-9c25-c62f60600427.png)

## Table Structure
There are Two tables 
Teams and Player consisting One to Many relationship
1. Teams
- ` TeamID, TeamName  ,TeamLocation ,CreatedAt ,UpdatedAt`
2. Players
- `PlayerId, PlayerName, PlayerAge, CreatedAt, UpdatedAt, Team_id_fk`
	- Team id in players table is a foregin key from teams table estabilsing one to many relationship

<img width="689" alt="tables" src="https://user-images.githubusercontent.com/71382700/155876203-bb86c845-d483-46b3-b630-a7ce898771f9.png">


## Configuring Database
Used MySQL as Databse in this project and HIbernate As Object-Relational Mapping(ORM), following is the resource file containg approach to connect with MySQL and Using Hibernate.

    #Estabilising connection with DB
    spring.datasource.url=jdbc:mysql://localhost:3306/cliffassessment?useSSL=false 
    #myusername
    spring.datasource.username=root 
    #mypassword
    spring.datasource.password=root  
    
    #Hibernate properties
    spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect
    spring.jpa.hibernate.ddl-auto=update
    

## Creation of Models
 Created Two models in Entity package 
 1.Players
```java
 
     package ai.cliff.assessment.model;
    
    import java.util.Date;
    
    import javax.persistence.Entity;
    import javax.persistence.Id;
    import javax.persistence.Table;
    
    import com.fasterxml.jackson.annotation.JsonFormat;
    
    import lombok.Data;
    
    @Data
    @Entity //declaring as Entity
    @Table(name ="players") //giving table name
    public class Player {
    	
    		@Id
    		@JsonFormat(shape = JsonFormat.Shape.NUMBER)
    		private int playerid;//made teamid as primary key for teams table which will be autogenerated value
    		
    		//formating name and age
    		@JsonFormat(shape = JsonFormat.Shape.STRING)
    		private String playername;
    		
    		@JsonFormat(shape = JsonFormat.Shape.NUMBER)
    		private int playerage;
    			
    		//formating date format for createdat and updatedat columns
    		@JsonFormat(shape=JsonFormat.Shape.STRING, pattern = "dd/MM/yyyy")
    		private Date createdat;
    		
    		@JsonFormat(shape=JsonFormat.Shape.STRING, pattern = "dd/MM/yyyy")
    		private Date updatedat;
    
    		@JsonFormat(shape=JsonFormat.Shape.NUMBER)
    		private int pteamId;
    		
    		
    		//Generating getters and setters
    		public int getPteamId() {
    			return pteamId;
    		}
    		public void setPteamId(int pteamId) {
    			this.pteamId = pteamId;
    		}
    		public int getPlayerid() {
    			return playerid;
    		}
    		public void setPlayerid(int playerid) {
    			this.playerid = playerid;
    		}
    		public String getPlayername() {
    			return playername;
    		}
    		public void setPlayername(String playername) {
    			this.playername = playername;
    		}
    		public int getPlayerage() {
    			return playerage;
    		}
    		public void setPlayerage(int playerage) {
    			this.playerage = playerage;
    		}
    		public Date getCreatedat() {
    			return createdat;
    		}
    		public void setCreatedat(Date createdat) {
    			this.createdat = createdat;
    		}
    		public Date getUpdatedat() {
    			return updatedat;
    		}
    		public void setUpdatedat(Date updatedat) {
    			this.updatedat = updatedat;
    		}
    		
    		
    }
    
```
2.Teams
```java

    package ai.cliff.assessment.model;
    
    import java.util.Date;
    import java.util.List;
    
    import javax.persistence.CascadeType;
    import javax.persistence.Entity;
    import javax.persistence.GeneratedValue;
    import javax.persistence.Id;
    import javax.persistence.JoinColumn;
    import javax.persistence.OneToMany;
    import javax.persistence.Table;
    
    import com.fasterxml.jackson.annotation.JsonFormat;
    import com.fasterxml.jackson.annotation.JsonProperty;
    
    import lombok.Data;
    
    @Data
    @Entity //declaring as entity
    @Table(name="teams")//declaring table name
    public class Team {
    
    	@Id //declaring teamid as primary key
    	@GeneratedValue
    	@JsonFormat(shape = JsonFormat.Shape.NUMBER)
    	private int teamid;//made teamid as primary key for teams table which will be autogenerated value
    	//formating name and location
    	@JsonFormat(shape = JsonFormat.Shape.STRING)
    	private String teamname;
    	@JsonFormat(shape = JsonFormat.Shape.STRING)
    	private String teamlocation;
    	
    	//formating date format for createdat and updatedat columns
    	@JsonFormat(shape=JsonFormat.Shape.STRING, pattern = "dd/MM/yyyy")
    	private Date createdat;
    	@JsonFormat(shape=JsonFormat.Shape.STRING, pattern = "dd/MM/yyyy")
    	private Date updatedat;
    	
    	//for one to many mapping
    	@JsonFormat(shape = JsonFormat.Shape.ARRAY)
    	@OneToMany(targetEntity = Player.class,cascade = CascadeType.ALL)
    	@JoinColumn(name = "teamid_fk", referencedColumnName = "teamid")
    	private List<Player> players;
    	
    	//generating getters and setters
    	public int getTeamid() {
    		return teamid;
    	}
    	public void setTeamid(int teamid) {
    		this.teamid = teamid;
    	}
    	public String getTeamname() {
    		return teamname;
    	}
    	public void setTeamname(String teamname) {
    		this.teamname = teamname;
    	}
    	public String getTeamlocation() {
    		return teamlocation;
    	}
    	public void setTeamlocation(String teamlocation) {
    		this.teamlocation = teamlocation;
    	}
    	public Date getCreatedat() {
    		return createdat;
    	}
    	public void setCreatedat(Date createdat) {
    		this.createdat = createdat;
    	}
    	public Date getUpdatedat() {
    		return updatedat;
    	}
    	public void setUpdatedat(Date updatedat) {
    		this.updatedat = updatedat;
    	}
    	
    	
    }
    
```

## Repository
Created a Repository package that contains Interfaces of both the models and those interface extends to JPA Repository for getting access to its mehtods
1. PlayerRepository

```java
package ai.cliff.assessment.repository;

import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;

import ai.cliff.assessment.model.Player;

public interface PlayerRepository extends JpaRepository<Player, Integer>{

}

```
2 .TeamRepository

```java
package ai.cliff.assessment.repository;

import org.springframework.data.jpa.repository.JpaRepository;

import ai.cliff.assessment.model.Team;

public interface TeamRepository extends JpaRepository<Team, Integer> {

}

```

## Exception package
created an exception prackage which throws Resource not found excpetion  whenever some data is tried to fetch or update and it is not present in the Database.

```java
package ai.cliff.assessment.exception;

import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.ResponseStatus;

@ResponseStatus(value = HttpStatus.NOT_FOUND)
public class ResourceNotFoundException extends RuntimeException{
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private String resourceName;
	private String fieldName;
	private Object fieldValue;
	
	public ResourceNotFoundException(String resourceName, String fieldName, Object fieldValue) {
		super(String.format("%s not found with %s : '%s'", resourceName, fieldName, fieldValue));
		this.resourceName = resourceName;
		this.fieldName = fieldName;
		this.fieldValue = fieldValue;
	}
	
	public String getResourceName() {
		return resourceName;
	}
	
	public String getFieldName() {
		return fieldName;
	}
	
	public Object getFieldValue() {
		return fieldValue;
	}
	
}
```

## Service package and Service Implementation package
I have declared all the enpoints in the service interface and there implementation is sepratley present in service implementation class.
- PlayerService

```java
package ai.cliff.assessment.service;

import java.util.List;

import org.springframework.data.domain.Page;
import org.springframework.data.jpa.repository.Query;

import ai.cliff.assessment.model.Player;

public interface PlayerService {
	//Declearing all players Methods
	Player savePlayer(Player player);
	Page<Player> getPlayers(int offset ,int pageSize, String field);
	Player getPlayerById(int Id);
	Player updatePlayer(Player team, int Id);
	void deletePlayer(int id);
	

	
}

```

TeamService

```java
package ai.cliff.assessment.service;


import org.springframework.data.domain.Page;

import ai.cliff.assessment.model.Team;

public interface TeamService {
	//Declearing all teams Methods
	Team saveTeam(Team team);
	Page<Team> getTeams(int offset ,int pageSize, String field); 
	Team getTeamById(int Id);
	Team updateTeam(Team team, int Id);
	void deleteTeam(int id);
	
}

```

The endpoints are defined seapratley 

# Endpoints and Explaination

## All Endpoints
```css
Create--Team,player
Find by ID -- Team,Player
Update -- Team,Player
Delete -- Team,Player
All record with pagination and ordering sequence -- Team,Player

```
## Teams Endpoint

- ### Creating teams

Service

```java
	Team saveTeam(Team team);
	

```

Service implementation

```java
	//saving teams
	@Override
	public Team saveTeam(Team team) {
		return teamRepository.save(team);
	}

```
Controller class

```java
	//REST API to add teams
	@PostMapping()
	public ResponseEntity<Team> saveTeam(@RequestBody Team team){
		return new ResponseEntity<Team>(teamservice.saveTeam(team), HttpStatus.CREATED);
	}

```

ScreenShot of postman

![postmehtod adding teams](https://user-images.githubusercontent.com/71382700/155874522-d6d6529b-7ca3-4576-91be-267593d943fc.png)

- ### Find Team by Team ID

Service

```java
Team getTeamById(int Id);

```
Service Implementation

```java
	//finding team by team id
	@Override
	public Team getTeamById(int Id) {
		Optional<Team> team = teamRepository.findById(Id);
		if(team.isEmpty()) {
			throw new ResourceNotFoundException("Team", "ID", Id);
		}else {
			return team.get();
		}
	}


```

Controller Class

```java
	
	//REST API to get team by ID
	@GetMapping("{id}")
	public ResponseEntity<Team> fetchTeambyId(@PathVariable("id") int Id) {
		return new ResponseEntity<Team>(teamservice.getTeamById(Id),HttpStatus.OK);
	}
	

```

ScreenShot of  test on postman

![getmethof get team by id](https://user-images.githubusercontent.com/71382700/155874658-89afdbf3-4f43-41e6-989e-ee54ed6b4596.png)

- ### Updating Teams

Service

```java
Team updateTeam(Team team, int Id);
```
Service Implementation

```java
	//updating teams, only one field can also be updated
	@Override
	public Team updateTeam(Team team, int Id) {
		//checking team with given id exists or not
		Team exisitingTeam = teamRepository.findById(Id).orElseThrow(
				() -> new ResourceNotFoundException("Team", "id", Id));
		if(team.getTeamname()!=null){
				exisitingTeam.setTeamname(team.getTeamname());
		}
		if(team.getTeamlocation()!=null){
			exisitingTeam.setTeamlocation(team.getTeamlocation());
			}
		if(team.getTeamname()!=null){
			exisitingTeam.setTeamname(team.getTeamname());
	}
		if(team.getCreatedat()!=null){
			exisitingTeam.setCreatedat(team.getCreatedat());
			}
		if(team.getCreatedat()!=null){
			exisitingTeam.setCreatedat(team.getCreatedat());
	}
	
		//saving exisiting team to DB
		teamRepository.save(exisitingTeam);
		return exisitingTeam;
		
	}

```

Controller Class

```java
//REST API to update teaminfo
	@PutMapping("{Id}")
	public ResponseEntity<Team> updateTeam(@PathVariable("Id") int id
																,@RequestBody Team team){
		return new ResponseEntity<Team>(teamservice.updateTeam(team, id), HttpStatus.OK);
		
	}

```

ScreenShot of test on psotman

![update team record before](https://user-images.githubusercontent.com/71382700/155874936-9f238123-0a82-412e-9b47-d41e4e263f84.png)

updating record before

![update team record After](https://user-images.githubusercontent.com/71382700/155874939-8f84f08d-f3f8-444f-9c27-eb1b14b9119d.png)

updated record after

- ### finding all teams with pagination and Sorting order

Service

```java
Page<Team> getTeams(int offset ,int pageSize, String field); 
```
Service Implementation

```java
	//finding teams with pagination and sorting order
	@Override
	public Page<Team> getTeams(int offset, int pageSize, String field) {
		Page<Team> teams= teamRepository.findAll(PageRequest.of(offset,pageSize).withSort(Sort.by(field)));
		return teams;
	}

```

Controller Class

```java
	
	//REST API to get all teams with pagination and required ascending order
	@GetMapping("/getTeams/{offset}/{pageSize}/{field}")
	public Page<Team> fetchTeams(@PathVariable int offset, @PathVariable int pageSize ,@PathVariable String field){
		Page<Team> teams = teamservice.getTeams(offset, pageSize, field);
		return teams;
	}
	
	
```

ScreenShot of test on psotman

![teams with pagination page 1](https://user-images.githubusercontent.com/71382700/155875092-2e14a5fd-1077-4fda-8123-2e2eca6829bf.png)

page 1

![teams with pagination page 2](https://user-images.githubusercontent.com/71382700/155875109-e7f6a371-afd5-414c-a0d6-7c52d68e082e.png)

page2

- ### Deleting Team Record

Service

```java
void deleteTeam(int id);
```
Service Implementation

```java
	//deleting teams by ID
	@Override
	public void deleteTeam(int id) {
		//checking if team exists in DB
		teamRepository.findById(id).orElseThrow(
				() -> new ResourceNotFoundException("Team", "Id", id));
		teamRepository.deleteById(id);
		
	}

```

Controller Class

```java
	//REST API to delete team info
	@DeleteMapping("{Id}")
	public ResponseEntity<String> deleteTeam(@PathVariable("Id") int id){
		teamservice.deleteTeam(id);
		return new ResponseEntity<String>("Team deleted Successfully",HttpStatus.OK);
	}
	

```

ScreenShot of test on psotman


![Team Deleted](https://user-images.githubusercontent.com/71382700/155875165-940a7494-cc9f-4087-8ef9-fde0385a7ed0.png)


------------

## Players EndPoint

- ### Creating Player

Service

```java
Player savePlayer(Player player);

```

ServiceImplementation

```java
	//implemntation to save players		
	@Override
	public Player savePlayer(Player player) {
		return playerRepository.save(player);
	}



```

Controller Class

```java
//rest api to save players
	@PostMapping
	public ResponseEntity<Player> savePlayer(@RequestBody Player player){
			return new ResponseEntity<Player>(playerService.savePlayer(player), HttpStatus.CREATED);
	}
	
```

ScreenShot of testing on postman

![saving players](https://user-images.githubusercontent.com/71382700/155875811-3719a40f-fb3b-4d65-bc39-5d4a4d55edca.png)



- ### Find player by playerID

Service

```java
Player getPlayerById(int Id);

```

ServiceImplementation

```java
	public Player getPlayerById(int Id) {
		// TODO Auto-generated method stub
		Optional<Player> player = playerRepository.findById(Id);
		if(player.isEmpty()) {
			throw new ResourceNotFoundException("Player", "ID", Id);
		}else {
			return player.get();
		}
	}

```

Controller Class

```java
	//REST API to get players by ID
		@GetMapping("{id}")
		public ResponseEntity<Player> fetchPlayerbyId(@PathVariable("id") int Id) {
			return new ResponseEntity<Player>(playerService.getPlayerById(Id),HttpStatus.OK);
		}

```

ScreenShot of testing on postman

![find player by id](https://user-images.githubusercontent.com/71382700/155875820-6f08b367-5539-4011-8142-f4e3f87cd342.png)



- ### Update Player

Service

```java
	Player updatePlayer(Player team, int Id);

```

ServiceImplementation

```java
	//implementation update players
	@Override
	public Player updatePlayer(Player player, int Id) {
		//checking team with given id exists or not
		Player exisitingPlayer = playerRepository.findById(Id).orElseThrow(
				() -> new ResourceNotFoundException("Player", "id", Id));
		if(player.getPlayername()!=null){
				exisitingPlayer.setPlayername(player.getPlayername());
		}
		if(player.getUpdatedat()!=null) {
			exisitingPlayer.setUpdatedat(player.getUpdatedat());
		}
		if(player.getCreatedat()!=null) {
			exisitingPlayer.setCreatedat(player.getCreatedat());
		}
		if(player.getPlayerage()!=0) {
			exisitingPlayer.setPlayerage(player.getPlayerage());
		}
		if(player.getPteamId()!=0) {
			exisitingPlayer.setPteamId(player.getPteamId());
		}
		//saving exisiting team to DB
		playerRepository.save(exisitingPlayer);
		return exisitingPlayer;
	
	}

```

Controller Class

```java
		//REST API to update teaminfo
		@PutMapping("{Id}")
		public ResponseEntity<Player> updatePlayer(@PathVariable("Id") int id
																	,@RequestBody Player player){
			return new ResponseEntity<Player>(playerService.updatePlayer(player, id), HttpStatus.OK);
			
		}

```

ScreenShot of testing on postman

![player updationbefore](https://user-images.githubusercontent.com/71382700/155875810-89bfe5d8-6b33-4cd2-9d94-c2ad0094dadd.png)

Player Update Before


![player updation afterr](https://user-images.githubusercontent.com/71382700/155875807-4ea7c1a6-18bc-4ebd-a09d-54be5ea87635.png)

Player Update After


- ### Find all record with pagination and Sorting order

Service

```java
Page<Player> getPlayers(int offset ,int pageSize, String field);

```

ServiceImplementation

```java
	//implementation to get players with pagination and sorting order
	@Override
	public Page<Player> getPlayers(int offset, int pageSize, String field) {
		Page<Player> players= playerRepository.findAll(PageRequest.of(offset,pageSize).withSort(Sort.by(field)));
		return players;
	}



```

Controller Class

```java
	//find record with pagination and sorting
	@GetMapping("/getPlayers/{offset}/{pageSize}/{field}")
	public Page<Player> fetchPlayers(@PathVariable int offset, @PathVariable int pageSize ,@PathVariable String field){
		Page<Player> players = playerService.getPlayers(offset, pageSize, field);
		return players;
	}

```

ScreenShot of testing on postman

![player list with pagination](https://user-images.githubusercontent.com/71382700/155875821-720b38b4-4d91-4078-a9dd-06a8f27d94c5.png)

- ### delete player

Service

```java
void deletePlayer(int id);

```

ServiceImplementation

```java
	//implementation to delte players
	@Override
	public void deletePlayer(int id) {
		//checking if team exists in DB
				playerRepository.findById(id).orElseThrow(
						() -> new ResourceNotFoundException("Player", "Id", id));
				playerRepository.deleteById(id);
	}


```

Controller Class

```java
		//REST API to delete team info
		@DeleteMapping("{Id}")
		public ResponseEntity<String> deletePlayer(@PathVariable("Id") int id){
			playerService.deletePlayer(id);
			return new ResponseEntity<String>("Player deleted Successfully",HttpStatus.OK);
		}


```

ScreenShot of testing on postman


![deleting player](https://user-images.githubusercontent.com/71382700/155875815-77b89d11-c4d6-4a51-bed3-56e8ee7f7f40.png)

## Swagger Conifg.
Atlast when all the testpoints are ready and tested as said in the bonus task Swagger is createdfor the API for more user friendly expirence
```java
package ai.cliff.assessment.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.service.Contact;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

@Configuration
@EnableSwagger2
public class SwaggerConfig {
    @Bean
    public Docket api() {
        return new Docket(DocumentationType.SWAGGER_2)
                .select()
                .apis(RequestHandlerSelectors.basePackage("ai.cliff.assessment"))
                .paths(PathSelectors.any())
                .build().apiInfo(metaData());
    }

    private ApiInfo metaData() {
        return new ApiInfoBuilder()
                .title("CLiff Java Backend Assessment Swagger Configuration")
                .description("\"Swagger configuration for application \"")
                .version("1.1.0")
                .license("Apache 2.0")
                .licenseUrl("https://www.apache.org/licenses/LICENSE-2.0\"")
                .build();
    }
}
```


### End
